# Emacs AppImage Builder

This project provides a script to build a portable Emacs AppImage for Linux.

## Features

- Builds Emacs with xwidgets support
- Creates a portable, self-contained AppImage
- Supports custom icons
- Configurable Emacs version

## Requirements

- Linux system (tested on Arch Linux, Ubuntu, Fedora)
- Docker (for sandboxed builds)
- Internet connection for downloading dependencies

## Usage

### Building Locally

1. Clone this repository:
   ```bash
   git clone https://github.com/yourusername/emacs-app-image-builder.git
   cd emacs-app-image-builder
   ```

2. Run the build script:
   ```bash
   ./build-emacs-appimage.sh
   ```

3. Optional arguments:
   - `--icon, -i`: Specify a custom icon URL
   - `--version, -v`: Specify Emacs version (default: 29.4)
   - `--output, -o`: Specify output filename

### Building with Docker (Recommended)

Use the following Docker command to build in a sandboxed Arch Linux environment:

#+begin_src sh
  sudo docker run -it --rm \
    -v $(pwd):/build \
    -w /build \
    archlinux \
    /bin/bash -c "
      pacman -Syu --noconfirm \
        base-devel \
        git \
        wget \
        curl \
        ca-certificates \
        gtk3 \
        gnutls \
        ncurses \
        libxml2 \
        libjpeg-turbo \
        libpng \
        libtiff \
        libwebp \
        gcc-libs \
        systemd-libs \
        sqlite \
        harfbuzz \
        libx11 \
        libxcb \
        libxext \
        libxrender \
        libxfixes \
        libxi \
        libxinerama \
        libxrandr \
        libxcursor \
        libxcomposite \
        libxdamage \
        libxxf86vm \
        libxau \
        libxdmcp \
        pcre2 \
        libffi \
        wayland \
        libxkbcommon \
        librsvg \
        gmp \
        mpfr \
        mpc \
        acl \
        attr \
        dbus \
        gtk-layer-shell \
        libtool \
        texinfo \
        automake \
        autoconf \
        bison \
        flex \
        libgccjit \
        webkit2gtk \
        imagemagick \
        && \
      chmod +x build-emacs-appimage.sh \
      && \
      ./build-emacs-appimage.sh
    "
#+end_src

```

## Build Process

1. **Install Dependencies**: The script installs all required system dependencies.
2. **Download Emacs Source**: Downloads the specified Emacs version from GNU mirrors.
3. **Configure Emacs**: Configures Emacs with xwidgets, pgtk, and other features.
4. **Build Emacs**: Compiles Emacs with native compilation and tree-sitter support.
5. **Bundle Libraries**: Bundles all required libraries into the AppDir.
6. **Create AppImage**: Uses linuxdeploy to create the final AppImage.

## Notes

- The build process may take a long time (1-2 hours) depending on your system.
- The resulting AppImage is approximately 200-300MB in size.
- The script automatically updates the WEBKIT_BROKEN version to 2.51.92 in configure.ac.

## Troubleshooting

- If the build fails, check the error messages and ensure all dependencies are installed.
- For Docker builds, ensure you have sufficient disk space and permissions.
- If you encounter network issues, try running the build script again.

## License

This project is licensed under the GNU GPLv3 License.
